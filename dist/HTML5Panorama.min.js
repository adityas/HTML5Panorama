window.HTML5Panorama=function(a,b){function c(c){var f={canvas:"canvas",src:null,initialSpeed:10,num_slices:"auto",silentDegradeQualityIfNeeded:!0};for(var i in f)c.hasOwnProperty(i)||(c[i]=f[i]);return(v="string"==typeof c.canvas?b.getElementById(c.canvas):c.canvas)?("auto"!==c.num_slices&&(I=+c.num_slices),P=c.initialSpeed,p(v),v.width=a.innerWidth,v.height=a.innerHeight,v.style.cursor="ew-resize",k("hold",e),k("leave",h,b.body),k("keydown",g,top.window),u=v.getContext("2d"),t=new Image,t.onload=function(){w=t.height,x=t.width,y=360/x,N=x/2,j(),d(),q(v,c.silentDegradeQualityIfNeeded)},t.onerror=function(){console.error("Image "+c.src+" is not loaded")},void(t.src=c.src)):void console.error("HTML5Panorama Error: something goes wrong with 'canvas' option: "+c.canvas)}function d(){var a=0;z=1/y*(J/I),N+=P/K,B=2*w/(i(90-J/2)-i(90)),N>x&&(N-=x),0>N&&(N+=x),O=0,D=v.width/2;for(var b=0;I>b;b++)C=90-(J/2-b*J/I),C>90&&(C=180-C),A=z*i(C),E=N+b*z,F=E+z,F>x&&(E-=x-z),u.drawImage(t,E,0,z,w,a,w/2*K*(i(90-J/2)-i(C)),K*A+1,w*K*i(C)),a+=Math.round(K*A);r&&(u.fillStyle="#fff",u.fillRect(0,0,200,100),u.fillStyle="#000",u.font="normal 14pt sans-serif",u.fillText("fps: "+M,10,20),u.fillText("num_slices: "+I,10,40)),Q||(L||(P/=1.05),Math.abs(P)|!1&&H(d))}function e(a){a.preventDefault(),a.stopPropagation(),Q=!0,L=!1,G=o(a),k("move",f,b.body)}function f(a){a.preventDefault(),a.stopPropagation();var b=o(a);P=G-b,G=b,H(d)}function g(a){L=!1;var b=1;switch(a.keyCode){case 37:b=-1;case 39:Q=!0,P=5*b,H(d)}}function h(a){a.preventDefault(),a.stopPropagation(),l("move",f,b.body),Q=!1,d()}function i(a){return 1/Math.sin(a*Math.PI/180)}function j(){v.width=a.innerWidth,v.height=a.innerHeight,K=Math.min(v.width/(2+x/280*J),v.height/w/2)}function k(a,b,c){switch(c||(c=v),a){case"hold":m(c,"touchstart",b),m(c,"MSPointerDown",b),m(c,"mousedown",b);break;case"leave":m(c,"mouseup",b),m(c,"MSPointerUp",b),m(c,"touchend",b);break;case"move":m(c,"touchmove",b),m(c,"MSPointerMove",b),m(c,"mousemove",b);break;case"keydown":m(c,"keydown",b)}}function l(a,b,c){switch(c||(c=v),a){case"hold":n(c,"mousedown",b),n(c,"touchstart",b),n(c,"MSPointerDown",b);break;case"leave":n(c,"mouseup",b),n(c,"touchend",b),n(c,"MSPointerUp",b);break;case"move":n(c,"mousemove",b),n(c,"touchmove",b),n(c,"MSPointerMove",b)}}function m(a,b,c){a.addEventListener?a.addEventListener(b,c):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c}function n(a,b,c){a.removeEventListener?a.removeEventListener(b,c):a.attachEvent?a.detachEvent("on"+b,c):a["on"+b]=null}function o(a){return a.hasOwnProperty("touches")&&a.touches[0].pageX||a.pageX||0}function p(a){a.style["user-select"]="none",a.style["-ms-user-select"]="none",a.style["-moz-user-select"]="none",a.style["-khtml-user-select"]="none",a.style["-webkit-user-select"]="none",a.style["touch-action"]="none",a.style["-ms-touch-action"]="none",a.style["-ms-touch-action"]="none"}function q(a,b){var c=0,d=+new Date,e=function(){if(M=s.getFPS(),b&&10>M){if(c++,c>10)return void(I=Math.max(I/4,a.width/100|0));+new Date-d>5e3&&(c=0),d=+new Date}H(e)};H(e)}var r=!1,s={startTime:0,frameNumber:0,getFPS:function(){this.frameNumber++;var a=(new Date).getTime(),b=(a-this.startTime)/1e3,c=Math.floor(this.frameNumber/b);return b>1&&(this.startTime=(new Date).getTime(),this.frameNumber=0),c}};m(a,"resize",function(){j(),d()});var t,u,v,w,x,y,z,A,B,C,D,E,F,G,H=function(){return a.requestAnimationFrame||a.webkitRequestAnimationFrame||a.mozRequestAnimationFrame||a.oRequestAnimationFrame||a.msRequestAnimationFrame||function(b){a.setTimeout(b,1e3/60)}}(),I=Math.min(600,a.innerWidth),J=120,K=1,L=!0,M=s.getFPS(),N=0,O=0,P=0,Q=!1;return c}(window,document);